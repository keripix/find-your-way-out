!function(e,t,n){function i(n,o){if(!t[n]){if(!e[n]){var s=typeof require=="function"&&require;if(!o&&s)return s(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";n.parsePosition=function(e){var t=[];if(toString.call(e)!="[object Array]"){e=[e]}e.forEach(function(e){t.push({x:e.x||0,y:e.y||0,width:e.width||10,height:e.height||10,color:e.color||"#000000"})});return t};n.generate=function(e,t){var n=this.parsePosition(t),i=e.getContext("2d");n.forEach(function(e){i.fillStyle=e.color;i.fillRect(e.x,e.y,e.width,e.height)});return e}},{}],2:[function(e,t,n){"use strict";t.exports=i;function i(e){this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height;this.midX=this.x+this.width/2;this.midY=this.y+this.height/2;this.color=e.color;this.isMoving=false;this.requestRendering=false;this.requestRenderingForce=false;this.moving={amount:0,value:0,direction:0}}i.prototype.moveX=function(e){this.moving={value:e,direction:"x"};this.x+=e;this.midX+=e;this.isMoving=true;this.requestRendering=true;return this};i.prototype.moveY=function(e){this.moving={value:e,direction:"y"};this.y+=e;this.midY+=e;this.isMoving=true;this.requestRendering=true;return this};i.prototype.stop=function(){this.moving={amount:0,value:0,direction:0};this.isMoving=false;this.requestRendering=false;return this}},{}],3:[function(e,t,n){t.exports={world:{width:600,height:600,actor:{width:10,height:10,color:"#ECF0F1"},out:{width:10,height:10,color:"#27AE60"},blocks:{width:10,height:10,color:"#000000"}},levels:[{blocks:[{x:300,y:290},{x:50,y:60},{x:20,y:30}],actor:{x:300,y:580},out:{x:590,y:300}},{blocks:[{x:10,y:50},{x:20,y:500},{x:300,y:400},{x:150,y:410},{x:160,y:290},{x:500,y:500}],actor:{x:300,y:500},out:{x:590,y:300}},{blocks:[{x:300,y:400},{x:50,y:410},{x:500,y:410},{x:60,y:290},{x:500,y:290}],actor:{x:300,y:500},out:{x:590,y:300}}]}},{}],4:[function(e,t,n){"use strict";t.exports=i;function i(e,t,n,i){this.actor=e;this.blocks=t;this.exit=n;this.world=i}i.prototype.observe=function(){var e=this.actor.moving.direction,t=e==="x"?"y":"x",n=e==="x"?this.actor.width:this.actor.height,i=e==="x"?"width":"height";if(this.hasWon(i)){this.actor.stop();this.actor.hasWon=true;return}if(this.hasLost()){this.actor.stop();this.actor.hasLost=true;return}this.blocks.forEach(function(e){if(e[t]<this.actor[t]+n&&e[t]>this.actor[t]-n){var r=Math.pow(this.actor.midX-e.midX,2)+Math.pow(this.actor.midY-e.midY,2),o=Math.pow((this.actor[i]+e[i])/2,2);if(r<=o){this.detectStopper(this.actor,e).normalizeAfterCollision(this.actor,e,Math.sqrt(r));this.actor.stop()}}}.bind(this))};i.prototype.hasWon=function(e){return Math.sqrt(Math.pow(this.actor.midX-this.exit.midX,2)+Math.pow(this.actor.midY-this.exit.midY,2))<=(this.actor[e]+this.exit[e])/2};i.prototype.hasLost=function(){return this.actor.x>=this.world.width||this.actor.y>=this.world.height||this.actor.x<=0||this.actor.y<=0};i.prototype.detectStopper=function(e,t){e.stopperLocation=e.moving.value>=0?e.moving.direction:"-"+e.moving.direction;return this};i.prototype.normalizeAfterCollision=function(e,t,n){if(!e.hasOwnProperty("stopperLocation")){this.detectStopper(e,t)}var i=e.moving.direction,r=i==="x"?t.width:t.height,o=Math.abs(r-Math.round(n));if(o!==0){o=e.moving.value>0?-1*o:o;e[e.moving.direction]+=o;e["mid"+e.moving.direction.toUpperCase()]+=o;e.requestRenderingForce=true}return this}},{}],5:[function(e,t,n){!function(){"use strict";var n=e("./block"),i=e("./actor");t.exports=r;function r(e){this.parseConf(e)}r.prototype.parseConf=function(e){if(!e.world||!e.levels){throw new Error("Required params not provided")}this.conf=e;this.world=e.world;this.levels=[];e.levels.forEach(function(t){var r={};r.actor=new i({x:t.actor.x,y:t.actor.y,width:t.actor.width||e.world.actor.width,height:t.actor.height||e.world.actor.height,color:t.actor.color||e.world.actor.color});r.out=new n({x:t.out.x,y:t.out.y,width:t.out.width||e.world.out.width,height:t.out.height||e.world.out.height,color:t.out.color||e.world.out.color});r.blocks=[];t.blocks.forEach(function(t){r.blocks.push(new n({x:t.x,y:t.y,width:t.width||e.world.blocks.width,height:t.height||e.world.blocks.height,color:t.color||e.world.blocks.color}))});this.levels.push(r)}.bind(this))};r.prototype.getLevel=function(e){return this.levels[e-1]};r.prototype.createActor=function(e){var t=this.conf.levels[e-1];return new i({x:t.actor.x,y:t.actor.y,width:t.actor.width||this.world.actor.width,height:t.actor.height||this.world.actor.height,color:t.actor.color||this.world.actor.color})}}()},{"./block":2,"./actor":6}],7:[function(e,t,n){"use strict";var i=e("./gameConfiguration"),r=e("./worldGenerator"),o=e("./block"),s=e("../conf/game"),u=e("game-shell")(),a=e("./aware");var c,l=new i(s),f=1,h,d,p,m,v=10,w,g,y={};u.bind("move-left","left","A");u.bind("move-right","right","D");u.bind("move-down","down","S");u.bind("move-up","up","W");function b(){c.clearRect(0,0,600,600);m.clearRect(0,0,600,600);if(!h){return}if(f>s.levels.length){u.paused=true;return}w=l.createActor(f);w.stopperLocation=undefined;r.generate(d,w);r.generate(p,h.blocks);r.generate(p,h.out);g=new a(w,h.blocks,h.out,{width:600,height:600})}u.on("init",function(){d=document.getElementById("fywo");p=document.getElementById("background");h=l.getLevel(f);c=d.getContext("2d");m=p.getContext("2d");u.element.appendChild(d);u.element.appendChild(p);b()});u.on("tick",function(){if(w.hasWon){h=l.getLevel(++f);b();return}if(w.hasLost){b();return}if(w.isMoving){g.observe();return}if(u.wasDown("move-left")&&w.stopperLocation!=="-x"){y={direction:"x",value:-v};w.requestRendering=true}else if(u.wasDown("move-right")&&w.stopperLocation!=="x"){y={direction:"x",value:v};w.requestRendering=true}else if(u.wasDown("move-up")&&w.stopperLocation!=="-y"){y={direction:"y",value:-v};w.requestRendering=true}else if(u.wasDown("move-down")&&w.stopperLocation!=="y"){y={direction:"y",value:v};w.requestRendering=true}});u.on("render",function(){if(w.requestRenderingForce){w.requestRenderingForce=false;c.clearRect(w.x-10,w.y-10,w.width+20,w.height+20);c.fillRect(w.x,w.y,w.width,w.height)}else if(w.requestRendering){c.clearRect(w.x,w.y,w.width,w.height);c.fillStyle=w.color;w["move"+y.direction.toUpperCase()].call(w,y.value);c.fillRect(w.x,w.y,w.width,w.height)}})},{"./gameConfiguration":5,"./worldGenerator":1,"./block":2,"../conf/game":3,"./aware":4,"game-shell":8}],9:[function(e,t,n){var i=t.exports={};i.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}if(t){var n=[];window.addEventListener("message",function(e){if(e.source===window&&e.data==="process-tick"){e.stopPropagation();if(n.length>0){var t=n.shift();t()}}},true);return function i(e){n.push(e);window.postMessage("process-tick","*")}}return function r(e){setTimeout(e,0)}}();i.title="browser";i.browser=true;i.env={};i.argv=[];i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],10:[function(e,t,n){!function(e){if(!e.EventEmitter)e.EventEmitter=function(){};var t=n.EventEmitter=e.EventEmitter;var i=typeof Array.isArray==="function"?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"};function r(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++){if(t===e[n])return n}return-1}var o=10;t.prototype.setMaxListeners=function(e){if(!this._events)this._events={};this._events.maxListeners=e};t.prototype.emit=function(e){if(e==="error"){if(!this._events||!this._events.error||i(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var t=this._events[e];if(!t)return false;if(typeof t=="function"){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return true}else if(i(t)){var n=Array.prototype.slice.call(arguments,1);var r=t.slice();for(var o=0,s=r.length;o<s;o++){r[o].apply(this,n)}return true}else{return false}};t.prototype.addListener=function(e,t){if("function"!==typeof t){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",e,t);if(!this._events[e]){this._events[e]=t}else if(i(this._events[e])){if(!this._events[e].warned){var n;if(this._events.maxListeners!==undefined){n=this._events.maxListeners}else{n=o}if(n&&n>0&&this._events[e].length>n){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);console.trace()}}this._events[e].push(t)}else{this._events[e]=[this._events[e],t]}return this};t.prototype.on=t.prototype.addListener;t.prototype.once=function(e,t){var n=this;n.on(e,function i(){n.removeListener(e,i);t.apply(this,arguments)});return this};t.prototype.removeListener=function(e,t){if("function"!==typeof t){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[e])return this;var n=this._events[e];if(i(n)){var o=r(n,t);if(o<0)return this;n.splice(o,1);if(n.length==0)delete this._events[e]}else if(this._events[e]===t){delete this._events[e]}return this};t.prototype.removeAllListeners=function(e){if(arguments.length===0){this._events={};return this}if(e&&this._events&&this._events[e])this._events[e]=null;return this};t.prototype.listeners=function(e){if(!this._events)this._events={};if(!this._events[e])this._events[e]=[];if(!i(this._events[e])){this._events[e]=[this._events[e]]}return this._events[e]}}(e("__browserify_process"))},{__browserify_process:9}],11:[function(e,t,n){var i=e("events");n.isArray=r;n.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"};n.isRegExp=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"};n.print=function(){};n.puts=function(){};n.debug=function(){};n.inspect=function(e,t,i,u){var a=[];var c=function(e,t){var n={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};var i={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[t];if(i){return"["+n[i][0]+"m"+e+"["+n[i][1]+"m"}else{return e}};if(!u){c=function(e,t){return e}}function h(e,i){if(e&&typeof e.inspect==="function"&&e!==n&&!(e.constructor&&e.constructor.prototype===e)){return e.inspect(i)}switch(typeof e){case"undefined":return c("undefined","undefined");case"string":var u="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return c(u,"string");case"number":return c(""+e,"number");case"boolean":return c(""+e,"boolean")}if(e===null){return c("null","null")}var d=l(e);var p=t?f(e):d;if(typeof e==="function"&&p.length===0){if(o(e)){return c(""+e,"regexp")}else{var m=e.name?": "+e.name:"";return c("[Function"+m+"]","special")}}if(s(e)&&p.length===0){return c(e.toUTCString(),"date")}var v,w,g;if(r(e)){w="Array";g=["[","]"]}else{w="Object";g=["{","}"]}if(typeof e==="function"){var y=e.name?": "+e.name:"";v=o(e)?" "+e:" [Function"+y+"]"}else{v=""}if(s(e)){v=" "+e.toUTCString()}if(p.length===0){return g[0]+v+g[1]}if(i<0){if(o(e)){return c(""+e,"regexp")}else{return c("[Object]","special")}}a.push(e);var b=p.map(function(t){var n,o;if(e.__lookupGetter__){if(e.__lookupGetter__(t)){if(e.__lookupSetter__(t)){o=c("[Getter/Setter]","special")}else{o=c("[Getter]","special")}}else{if(e.__lookupSetter__(t)){o=c("[Setter]","special")}}}if(d.indexOf(t)<0){n="["+t+"]"}if(!o){if(a.indexOf(e[t])<0){if(i===null){o=h(e[t])}else{o=h(e[t],i-1)}if(o.indexOf("\n")>-1){if(r(e)){o=o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2)}else{o="\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")}}}else{o=c("[Circular]","special")}}if(typeof n==="undefined"){if(w==="Array"&&t.match(/^\d+$/)){return o}n=JSON.stringify(""+t);if(n.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){n=n.substr(1,n.length-2);n=c(n,"name")}else{n=n.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");n=c(n,"string")}}return n+": "+o});a.pop();var _=0;var k=b.reduce(function(e,t){_++;if(t.indexOf("\n")>=0)_++;return e+t.length+1},0);if(k>50){b=g[0]+(v===""?"":v+"\n ")+" "+b.join(",\n  ")+" "+g[1]}else{b=g[0]+v+" "+b.join(", ")+" "+g[1]}return b}return h(e,typeof i==="undefined"?2:i)};function r(e){return e instanceof Array||Array.isArray(e)||e&&e!==Object.prototype&&r(e.__proto__)}function o(e){return e instanceof RegExp||typeof e==="object"&&Object.prototype.toString.call(e)==="[object RegExp]"}function s(e){if(e instanceof Date)return true;if(typeof e!=="object")return false;var t=Date.prototype&&f(Date.prototype);var n=e.__proto__&&f(e.__proto__);return JSON.stringify(n)===JSON.stringify(t)}function u(e){return e<10?"0"+e.toString(10):e.toString(10)}var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function c(){var e=new Date;var t=[u(e.getHours()),u(e.getMinutes()),u(e.getSeconds())].join(":");return[e.getDate(),a[e.getMonth()],t].join(" ")}n.log=function(e){};n.pump=null;var l=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};var f=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e){if(Object.hasOwnProperty.call(e,n))t.push(n)}return t};var h=Object.create||function(e,t){var n;if(e===null){n={__proto__:null}}else{if(typeof e!=="object"){throw new TypeError("typeof prototype["+typeof e+"] != 'object'")}var i=function(){};i.prototype=e;n=new i;n.__proto__=e}if(typeof t!=="undefined"&&Object.defineProperties){Object.defineProperties(n,t)}return n};n.inherits=function(e,t){e.super_=t;e.prototype=h(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})};var d=/%[sdj%]/g;n.format=function(e){if(typeof e!=="string"){var t=[];for(var i=0;i<arguments.length;i++){t.push(n.inspect(arguments[i]))}return t.join(" ")}var i=1;var r=arguments;var o=r.length;var s=String(e).replace(d,function(e){if(e==="%%")return"%";if(i>=o)return e;switch(e){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":return JSON.stringify(r[i++]);default:return e}});for(var u=r[i];i<o;u=r[++i]){if(u===null||typeof u!=="object"){s+=" "+u}else{s+=" "+n.inspect(u)}}return s}},{events:10}],6:[function(e,t,n){"use strict";var i=e("./block"),r=e("./inherits");t.exports=o;function o(e){i.call(this,e);this.hasWon=false;this.hasLost=false;this.blockedFrom=undefined}r(o,i)},{"./block":2,"./inherits":12}],13:[function(e,t,n){var i=0;var r=["ms","moz","webkit","o"];for(var o=0;o<r.length&&!window.requestAnimationFrame;++o){window.requestAnimationFrame=window[r[o]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[r[o]+"CancelAnimationFrame"]||window[r[o]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(e,t){var n=(new Date).getTime();var r=Math.max(0,16-(n-i));var o=window.setTimeout(function(){e(n+r)},r);i=n+r;return o};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}},{}],14:[function(e,t,n){var i="",r,o,s;if(window.addEventListener){r="addEventListener"}else{r="attachEvent";i="on"}s="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";function u(e,t,n,o){e[r](i+t,s=="wheel"?n:function(e){!e&&(e=window.event);var t={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:e.type=="MozMousePixelScroll"?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=false}};if(s=="mousewheel"){t.deltaY=-1/40*e.wheelDelta;e.wheelDeltaX&&(t.deltaX=-1/40*e.wheelDeltaX)}else{t.deltaY=e.detail}return n(t)},o||false)}t.exports=function(e,t,n){u(e,s,t,n);if(s=="DOMMouseScroll"){u(e,"MozMousePixelScroll",t,n)}}},{}],15:[function(e,t,n){if(window.performance.now){t.exports=function(){return window.performance.now()}}else if(window.performance.webktiNow){t.exports=function(){return window.performance.webkitNow()}}else if(Date.now){t.exports=Date.now}else{t.exports=function(){return(new Date).getTime()}}},{}],8:[function(e,t,n){"use strict";var i=e("events").EventEmitter,r=e("util"),o=e("domready"),s=e("vkey"),u=e("invert-hash"),a=e("uniq"),c=e("lower-bound"),l=e("iota-array"),f=Math.min;e("./lib/raf-polyfill.js");var h=e("./lib/mousewheel-polyfill.js");var d=e("./lib/hrtime-polyfill.js");var p=function(){var e=new Array(256),t,n,i;for(t=0;t<256;++t){e[t]="UNK"}for(t in s){i=s[t];if(i.charAt(0)==="<"&&i.charAt(i.length-1)===">"){i=i.substring(1,i.length-1)}i=i.replace(/\s/g,"-");e[parseInt(t)]=i}return e}();var m=a(Object.keys(u(p)));function v(e){var t=c(m,e);if(t<0||t>=m.length){return-1}return t}function w(e){return v(p[e])}function g(){i.call(this);this._curKeyState=new Array(m.length);this._pressCount=new Array(m.length);this._releaseCount=new Array(m.length);this._tickInterval=null;this._rafHandle=null;this._tickRate=0;this._lastTick=d();this._frameTime=0;this._paused=true;this._width=0;this._height=0;this._wantFullscreen=false;this._wantPointerLock=false;this._fullscreenActive=false;this._pointerLockActive=false;this._render=j.bind(undefined,this);for(var e=0;e<m.length;++e){this._curKeyState[e]=false;this._pressCount[e]=this._releaseCount[e]=0}this.element=null;this.bindings={};this.frameSkip=100;this.tickCount=0;this.frameCount=0;this.startTime=d();this.tickTime=this._tickRate;this.frameTime=10;this.stickyFullscreen=false;this.stuckyPointLock=false;this.scroll=[0,0,0];this.mouseX=0;this.mouseY=0;this.prevMouseX=0;this.prevMouseY=0}r.inherits(g,i);var y=g.prototype;y.keyNames=m;y.bind=function(e){var t;if(e in this.bindings){t=this.bindings[e]}else{t=[]}var n;for(var i=1,r=arguments.length;i<r;++i){n=arguments[i];if(v(n)>=0){t.push(n)}else if(n in this.bindings){var o=this.bindings[n];for(var s=0;s<o.length;++s){t.push(o[s])}}}t=a(t);if(t.length>0){this.bindings[e]=t}};y.unbind=function(e){if(e in this.bindings){delete this.bindings[e]}};function b(e,t,n){if(n in t){var i=t[n];for(var r=0,o=i.length;r<o;++r){if(e[v(i[r])]){return true}}return false}var s=v(n);if(s>=0){return e[s]}return false}function _(e,t,n){if(n in t){var i=t[n],r=0;for(var o=0,s=i.length;o<s;++o){r+=e[v(i[o])]}return r}var u=v(n);if(u>=0){return e[u]}return 0}y.down=function(e){return b(this._curKeyState,this.bindings,e)};y.wasDown=function(e){return this.down(e)||!!this.press(e)};y.up=function(e){return!this.down(e)};y.wasUp=function(e){return this.up(e)||!!this.release(e)};y.press=function(e){return _(this._pressCount,this.bindings,e)};y.release=function(e){return _(this._releaseCount,this.bindings,e)};Object.defineProperty(y,"paused",{get:function(){return this._paused},set:function(e){var t=!!e;if(t!==this._paused){if(!this._paused){this._paused=true;this._frameTime=f(1,(d()-this._lastTick)/this._tickRate);clearInterval(this._tickInterval);cancelAnimationFrame(this._rafHandle)}else{this._paused=false;this._lastTick=d()-Math.floor(this._frameTime*this._tickRate);this._tickInterval=setInterval(M,this._tickRate,this);this._rafHandle=requestAnimationFrame(this._render)}}}});function k(e){var t=e.element;if(e._wantFullscreen&&!e._fullscreenActive){var n=t.requestFullscreen||t.requestFullScreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullscreen||t.mozRequestFullScreen||function(){};n.call(t)}if(e._wantPointerLock&&!e._pointerLockActive){var i=t.requestPointerLock||t.webkitRequestPointerLock||t.mozRequestPointerLock||t.msRequestPointerLock||t.oRequestPointerLock||function(){};i.call(t)}}var x=document.exitFullscreen||document.cancelFullscreen||document.cancelFullScreen||document.webkitCancelFullscreen||document.webkitCancelFullScreen||document.mozCancelFullscreen||document.mozCancelFullScreen||function(){};Object.defineProperty(y,"fullscreen",{get:function(){return this._fullscreenActive},set:function(e){var t=!!e;if(!t){this._wantFullscreen=false;x.call(document)}else{this._wantFullscreen=true;k(this)}return this._fullscreenActive}});function L(e){e._fullscreenActive=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||false;if(!e.stickyFullscreen&&e._fullscreenActive){e._wantFullscreen=false}}var E=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock||function(){};Object.defineProperty(y,"pointerLock",{get:function(){return this._pointerLockActive},set:function(e){var t=!!e;if(!t){this._wantPointerLock=false;E.call(document)}else{this._wantPointerLock=true;k(this)}return this._pointerLockActive}});function A(e,t){e._pointerLockActive=e.element===(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||null);if(!e.stickyPointerLock&&e._pointerLockActive){e._wantPointerLock=false}}Object.defineProperty(y,"width",{get:function(){return this.element.clientWidth}});Object.defineProperty(y,"height",{get:function(){return this.element.clientHeight}});function S(e,t,n){var i=e._curKeyState[t];if(i!==n){if(n){e._pressCount[t]++}else{e._releaseCount[t]++}e._curKeyState[t]=n}}function M(e){var t=d()+e.frameSkip,n=e._pressCount,i=e._releaseCount,r,o,s,u=e._tickRate,a=m.length;while(!e._paused&&d()>=e._lastTick+u){if(d()>t){e._lastTick=d()+u;return}o=d();e.emit("tick");s=d();e.tickTime=s-o;++e.tickCount;e._lastTick+=u;for(r=0;r<a;++r){n[r]=i[r]=0}if(e._pointerLockActive){e.prevMouseX=e.mouseX=e.width>>1;e.prevMouseY=e.mouseY=e.height>>1}else{e.prevMouseX=e.mouseX;e.prevMouseY=e.mouseY}e.scroll[0]=e.scroll[1]=e.scroll[2]=0}}function j(e){if(e._paused){return}M(e);var t;if(e._paused){t=e._frameTime}else{t=f(1,(d()-e._lastTick)/e._tickRate)}++e.frameCount;var n=d();e.emit("render",t);var i=d();e.frameTime=i-n;requestAnimationFrame(e._render)}function C(e,t){var n=w(t.keyCode||t.char||t.which||t.charCode);if(n>=0){S(e,n,false)}}function F(e,t){var n=w(t.keyCode||t.char||t.which||t.charCode);if(n>=0){S(e,n,true)}}var O=l(32).map(function(e){return v("mouse-"+(e+1))});function R(e,t){for(var n=0;n<32;++n){S(e,O[n],!!(t&1<<n))}}function q(e,t){if(t.buttons!==undefined){R(e,t.buttons)}if(e._pointerLockActive){var n=t.movementX||t.mozMovementX||t.webkitMovementX||0,i=t.movementY||t.mozMovementY||t.webkitMovementY||0;e.mouseX+=n;e.mouseY+=i}else{e.mouseX=t.clientX-e.element.offsetLeft;e.mouseY=t.clientY-e.element.offsetTop}return false}function P(e,t){if(t.buttons===undefined){S(e,O[t.button],true)}else{R(e,t.buttons)}return false}function T(e,t){if(t.buttons===undefined){S(e,O[t.button],false)}else{R(e,t.buttons)}return false}function X(e,t){if(e._pointerLockActive){e.prevMouseX=e.mouseX=e.width>>1;e.prevMouseY=e.mouseY=e.height>>1}else{e.prevMouseX=e.mouseX=t.clientX-e.element.offsetLeft;e.prevMouseY=e.mouseY=t.clientY-e.element.offsetTop}return false}function D(e,t){R(e,0);return false}function Y(e,t){var n=1;switch(t.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=e.height;break}e.scroll[0]+=t.deltaX*n;e.scroll[1]+=t.deltaY*n;e.scroll[2]+=t.deltaZ*n||0;return false}function z(e,t){return false}function N(e,t){var n=m.length,i=e._curKeyState,r=e._releaseCount,o;for(o=0;o<n;++o){if(i[o]){++r[o]}i[o]=false}return false}function I(e,t){var n=e.element.clientWidth|0;var i=e.element.clientHeight|0;if(n!==e._width||i!==e._height){e._width=n;e._height=i;e.emit("resize",n,i)}}function U(){var e=document.createElement("div");e.style.position="absolute";e.style.left="0px";e.style.right="0px";e.style.top="0px";e.style.bottom="0px";e.style.height="100%";e.style.overflow="hidden";document.body.appendChild(e);return e}function W(e){e=e||{};var t=!!e.fullscreen;var n=t;if(typeof e.pointerLock!==undefined){n=!!e.pointerLock}var i=new g;i._tickRate=e.tickRate||30;i.frameSkip=e.frameSkip||(i._tickRate+5)*5;i.stickyFullscreen=!!e.stickyFullscreen||!!e.sticky;i.stickyPointerLock=!!e.stickPointerLock||!e.sticky;if(e.bindings){i.bindings=bindings}setTimeout(function(){o(function r(){var r=e.element;if(typeof r==="string"){var o=document.querySelector(r);if(!o){o=document.getElementById(r)}if(!o){o=document.getElementByClass(r)[0]}if(!o){o=U()}i.element=o}else if(typeof r==="object"&&!!r){i.element=r}else if(typeof r==="function"){i.element=r()}else{i.element=U()}if(i.element.style){i.element.style["-webkit-touch-callout"]="none";i.element.style["-webkit-user-select"]="none";i.element.style["-khtml-user-select"]="none";i.element.style["-moz-user-select"]="none";i.element.style["-ms-user-select"]="none";i.element.style["user-select"]="none"}i._width=i.element.clientWidth;i._height=i.element.clientHeight;var s=I.bind(undefined,i);if(typeof MutationObserver!=="undefined"){var u=new MutationObserver(s);u.observe(i.element,{attributes:true,subtree:true})}else{i.element.addEventListener("DOMSubtreeModified",s,false)}window.addEventListener("resize",s,false);window.addEventListener("keydown",F.bind(undefined,i),true);window.addEventListener("keyup",C.bind(undefined,i),true);i.element.oncontextmenu=z.bind(undefined,i);i.element.onmousedown=P.bind(undefined,i);i.element.onmouseup=T.bind(undefined,i);i.element.onmousemove=q.bind(undefined,i);i.element.onmouseenter=X.bind(undefined,i);var a=D.bind(undefined,i);i.element.onmouseleave=a;i.element.onmouseout=a;window.addEventListener("mouseleave",a,true);window.addEventListener("mouseout",a,true);var c=N.bind(undefined,i);i.element.onblur=c;window.addEventListener("blur",c,true);h(i.element,Y.bind(undefined,i),false);document.body.style.overflow="hidden";document.body.style.height="100%";var l=L.bind(undefined,i);document.addEventListener("fullscreenchange",l,false);document.addEventListener("mozfullscreenchange",l,false);document.addEventListener("webkitfullscreenchange",l,false);i.element.addEventListener("click",k.bind(undefined,i),true);var f=A.bind(undefined,i);document.addEventListener("pointerlockchange",f,false);document.addEventListener("mozpointerlockchange",f,false);document.addEventListener("webkitpointerlockchange",f,false);document.addEventListener("pointerlocklost",f,false);document.addEventListener("webkitpointerlocklost",f,false);document.addEventListener("mozpointerlocklost",f,false);i.fullscreen=t;i.pointerLock=n;i.bind("mouse-left","mouse-1");i.bind("mouse-right","mouse-3");i.bind("mouse-middle","mouse-2");i._lastTick=d();i.startTime=d();i.paused=false;i.emit("init")})},0);return i}t.exports=W},{events:10,util:11,"./lib/raf-polyfill.js":13,"./lib/mousewheel-polyfill.js":14,"./lib/hrtime-polyfill.js":15,domready:16,vkey:17,"invert-hash":18,uniq:19,"lower-bound":20,"iota-array":21}],16:[function(e,t,n){!function(e,n){if(typeof t!="undefined")t.exports=n();else if(typeof define=="function"&&typeof define.amd=="object")define(n);else this[e]=n()}("domready",function(e){var t=[],n,i=false,r=document,o=r.documentElement,s=o.doScroll,u="DOMContentLoaded",a="addEventListener",c="onreadystatechange",l="readyState",f=/^loade|c/.test(r[l]);function h(e){f=1;while(e=t.shift())e()}r[a]&&r[a](u,n=function(){r.removeEventListener(u,n,i);h()},i);s&&r.attachEvent(c,n=function(){if(/^c/.test(r[l])){r.detachEvent(c,n);h()}});return e=s?function(n){self!=top?f?n():t.push(n):function(){try{o.doScroll("left")}catch(t){return setTimeout(function(){e(n)},50)}n()}()}:function(e){f?e():t.push(e)}})},{}],17:[function(e,t,n){!function(){var e=typeof window!=="undefined"?window.navigator.userAgent:"",n=/OS X/.test(e),i=/Opera/.test(e),r=!/like Gecko/.test(e)&&!i;var o,s=t.exports={0:n?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:n?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num-->",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:n&&r?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:i?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(o=58;o<65;++o){s[o]=String.fromCharCode(o)}for(o=48;o<58;++o){s[o]=o-48+""}for(o=65;o<91;++o){s[o]=String.fromCharCode(o)}for(o=96;o<107;++o){s[o]="<num-"+(o-96)+">"}for(o=112;o<136;++o){s[o]="F"+(o-111)}}()},{}],18:[function(e,t,n){"use strict";function i(e){var t={};for(var n in e){if(e.hasOwnProperty(n)){t[e[n]]=n}}return t}t.exports=i},{}],19:[function(e,t,n){"use strict";function i(e,t){var n=1,i=e.length,r=e[0],o=e[0];for(var s=1;s<i;++s){o=r;r=e[s];if(t(r,o)){if(s===n){n++;continue}e[n++]=r}}e.length=n;return e}function r(e){var t=1,n=e.length,i=e[0],r=e[0];for(var o=1;o<n;++o,r=i){r=i;i=e[o];if(i!==r){if(o===t){t++;continue}e[t++]=i}}e.length=t;return e}function o(e,t,n){if(e.length===0){return[]}if(t){if(!n){e.sort(t)}return i(e,t)}if(!n){e.sort()}return r(e)}t.exports=o},{}],20:[function(e,t,n){"use strict";function i(e,t,n,i,r){i=i|0;r=r|0;while(i<r){var o=i+r>>>1,s=n(t,e[o]);if(s<0){r=o-1}else if(s>0){i=o+1}else{r=o}}if(n(e[i],t)<=0){return i}return i-1}function r(e,t,n,i){n=n|0;i=i|0;while(n<i){var r=n+i>>>1;if(t<e[r]){i=r-1}else if(t>e[r]){n=r+1}else{i=r}}if(e[n]<=t){return n}return n-1}function o(e,t,n,o,s){if(!o){o=0}if(typeof s!=="number"){s=e.length-1}if(n){return i(e,t,n,o,s)}return r(e,t,o,s)}t.exports=o},{}],21:[function(e,t,n){"use strict";function i(e){var t=new Array(e);for(var n=0;n<e;++n){t[n]=n}return t}t.exports=i},{}],12:[function(e,t,n){var i=e("./extend");t.exports=function(e,t){var n=Object.create(t.prototype);i(n,e.prototype);e.prototype=n}},{"./extend":22}],22:[function(e,t,n){t.exports=function(e,t){for(var n in t){if(hasOwnProperty.call(t,n)){e[n]=t[n]}}}},{}]},{},[7]);